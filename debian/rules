#!/usr/bin/make -f

# NOTE debian expects to install things into a specific directory. the scons build
#      system expects though to install into the directory set by custom.py which
#      is the same path hard-coded into the library. to fix this problem the archive
#      build is used. this creates the correct directory structure as if the build
#      is installed into a live system. then in an additional step the archive is
#      unpacked into the desired location. this is the safe way to do it

clean:
	scons -j 8 archive -c

build:
	scons -j 8 archive
	mkdir -p debian/dragengine
	tar -xvjf archive/build/dragengine-linux.tar.bz2 -C debian/dragengine
	mkdir -p debian/dragengine-dev
	tar -xvjf archive/build/dragengine-dev-linux.tar.bz2 -C debian/dragengine-dev
	mkdir -p debian/deigde
	tar -xvjf archive/build/deigde-linux.tar.bz2 -C debian/deigde
	mkdir -p debian/deigde-dev
	tar -xvjf archive/build/deigde-dev-linux.tar.bz2 -C debian/deigde-dev

binary:
	dh_testroot
	dh_prep
	dh_installdirs	
	
	scons -j 8 archive
	mkdir -p debian/dragengine
	tar -xvjf archive/build/dragengine-linux.tar.bz2 -C debian/dragengine
	mkdir -p debian/dragengine-dev
	tar -xvjf archive/build/dragengine-dev-linux.tar.bz2 -C debian/dragengine-dev
	mkdir -p debian/deigde
	tar -xvjf archive/build/deigde-linux.tar.bz2 -C debian/deigde
	mkdir -p debian/deigde-dev
	tar -xvjf archive/build/deigde-dev-linux.tar.bz2 -C debian/deigde-dev
	
	dh_install
	dh_installdocs
	dh_installchangelogs
	dh_installexamples
	dh_installman
	dh_installcatalogs
	dh_installcron
	dh_installdebconf
	dh_installemacsen
	dh_installifupdown
	dh_installinfo
	dh_installinit
	dh_installmenu
	dh_installmime
	dh_installmodules
	dh_installlogcheck
	dh_installlogrotate
	dh_installpam
	dh_installppp
	dh_installudev
	dh_installwm
	dh_installxfonts
	dh_bugfiles
	dh_lintian
	dh_gconf
	dh_icons
	dh_perl
	dh_usrlocal
	dh_link
	dh_compress
	dh_fixperms
	dh_strip
	dh_makeshlibs
	dh_shlibdeps -Xlibscrdscript -Xdsinstall
	#dh_shlibdeps -Xlibscrdscript -Xdsinstall \
	#  -l`find debian/dragengine/usr/lib/dragengine/modules -name "*.so" -printf "%h:"`\
	#    `find debian/deigde/usr/lib/deigde/modules -name "*.so" -printf "%h:"`
	
	dh_installdeb
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary-arch:
	# NOTE required by lintian

binary-indep:
	# NOTE required by lintian
